# LOKIZ Phase 3 ì™„ë£Œ ìš”ì•½

**ì™„ë£Œ ë‚ ì§œ**: 2025ë…„ 10ì›” 29ì¼

---

## ğŸ“‹ Phase 3 ëª©í‘œ

AI ì‘ì—… API êµ¬í˜„ - I2V ê¸°ë°˜ ë¹„ë””ì˜¤ ìƒì„± ë° ê¸€ë¦¬ì¹˜ ê¸°ëŠ¥

---

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. ê¸°íšì„œ ìˆ˜ì •
- **íŒŒì¼**: `/home/ubuntu/lokiz_planning_document.md`
- **ë³€ê²½ì‚¬í•­**:
  - VTV (Video-to-Video) â†’ I2V (Image-to-Video) ê¸°ë°˜ìœ¼ë¡œ ì „í™˜
  - ìŠ¤íŠœë””ì˜¤ ì›Œí¬í”Œë¡œìš° ëª…í™•í™”: ì˜ìƒ ì—…ë¡œë“œ â†’ í”„ë ˆì„ ìº¡ì²˜ â†’ í…œí”Œë¦¿ í”„ë¡¬í”„íŠ¸ + I2V
  - ê¸€ë¦¬ì¹˜ ê¸°ëŠ¥ ì¶”ê°€ (WAN 2.2 Animate/Replace ëª¨ë¸)
  - í¬ë ˆë”§ ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸

### 2. Replicate ì„œë¹„ìŠ¤ êµ¬í˜„
- **íŒŒì¼**: `/home/ubuntu/lokiz-backend/app/services/replicate_service.py`
- **êµ¬í˜„ ë©”ì„œë“œ**:
  - `generate_i2v_template()`: ëª¨ì…˜/ìŠ¤íƒ€ì¼ í…œí”Œë¦¿ ìƒì„± (veo-3-fast)
  - `generate_glitch_animate()`: ê¸€ë¦¬ì¹˜ ëª¨ì…˜ ì ìš© (WAN 2.2 Animate)
  - `generate_glitch_replace()`: ê¸€ë¦¬ì¹˜ ì£¼ì²´ êµì²´ (WAN 2.2 Replace)
  - `generate_music()`: ìŒì•… ìƒì„± (suno-ai/bark)

### 3. í”„ë ˆì„ ìº¡ì²˜ ìœ í‹¸ë¦¬í‹°
- **íŒŒì¼**: `/home/ubuntu/lokiz-backend/app/utils/video_utils.py`
- **êµ¬í˜„ í•¨ìˆ˜**:
  - `extract_frame_from_video()`: ffmpeg ê¸°ë°˜ í”„ë ˆì„ ì¶”ì¶œ
  - `get_video_duration()`: ë¹„ë””ì˜¤ ê¸¸ì´ í™•ì¸

### 4. AI ì‘ì—… ìŠ¤í‚¤ë§ˆ ì—…ë°ì´íŠ¸
- **íŒŒì¼**: `/home/ubuntu/lokiz-backend/app/schemas/ai_job.py`
- **ìƒˆë¡œìš´ ìŠ¤í‚¤ë§ˆ**:
  - `FrameCaptureRequest`: í”„ë ˆì„ ìº¡ì²˜ ìš”ì²­
  - `FrameCaptureResponse`: í”„ë ˆì„ ìº¡ì²˜ ì‘ë‹µ
  - `I2VTemplateRequest`: I2V í…œí”Œë¦¿ ìƒì„± ìš”ì²­
  - `GlitchAnimateRequest`: ê¸€ë¦¬ì¹˜ ëª¨ì…˜ ì ìš© ìš”ì²­
  - `GlitchReplaceRequest`: ê¸€ë¦¬ì¹˜ ì£¼ì²´ êµì²´ ìš”ì²­

### 5. AI ë¼ìš°í„° êµ¬í˜„
- **íŒŒì¼**: `/home/ubuntu/lokiz-backend/app/routers/ai.py`
- **êµ¬í˜„ ì—”ë“œí¬ì¸íŠ¸**:
  - `POST /v1/ai/capture-frame`: í”„ë ˆì„ ìº¡ì²˜
  - `POST /v1/ai/template`: ëª¨ì…˜/ìŠ¤íƒ€ì¼ í…œí”Œë¦¿ (20 í¬ë ˆë”§)
  - `POST /v1/ai/glitch/animate`: ê¸€ë¦¬ì¹˜ ëª¨ì…˜ ì ìš© (30 í¬ë ˆë”§)
  - `POST /v1/ai/glitch/replace`: ê¸€ë¦¬ì¹˜ ì£¼ì²´ êµì²´ (30 í¬ë ˆë”§)
  - `POST /v1/ai/music`: ìŒì•… ìƒì„± (5 í¬ë ˆë”§)
  - `GET /v1/ai/jobs/{job_id}`: AI ì‘ì—… ìƒíƒœ ì¡°íšŒ

### 6. Mock S3 ì„œë¹„ìŠ¤ í™•ì¥
- **íŒŒì¼**: `/home/ubuntu/lokiz-backend/app/services/mock_s3_service.py`
- **ì¶”ê°€ ë©”ì„œë“œ**:
  - `download_file()`: S3ì—ì„œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ (Mock)
  - `upload_file()`: S3ë¡œ íŒŒì¼ ì—…ë¡œë“œ (Mock)

### 7. ì½”ë“œ í’ˆì§ˆ ê²€ìˆ˜
- **Lint ê²€ì‚¬**: flake8 í†µê³¼ (0ê°œ ì˜¤ë¥˜)
- **ë„¤ì´ë° ê·œì¹™**: snake_case (ë³€ìˆ˜/í•¨ìˆ˜), PascalCase (í´ë˜ìŠ¤)
- **íƒ€ì… íŒíŒ…**: ëª¨ë“  í•¨ìˆ˜ì— íƒ€ì… íŒíŠ¸ ì ìš©
- **ë¬¸ì„œí™”**: ëª¨ë“  í•¨ìˆ˜ì— docstring ì‘ì„±

---

## ğŸ¯ í•µì‹¬ ê¸°ëŠ¥

### A. ëª¨ì…˜/ìŠ¤íƒ€ì¼ í…œí”Œë¦¿ (I2V ê¸°ë°˜)
**ì‘ë™ ë°©ì‹**:
1. ë©”ì¸ ì˜ìƒ ì—…ë¡œë“œ í›„ í”„ë¦¬ë·° ì¬ìƒ
2. ì›í•˜ëŠ” ì¥ë©´ì—ì„œ í”„ë ˆì„ ìº¡ì²˜ (ì´ë¯¸ì§€ ì¶”ì¶œ)
3. í…œí”Œë¦¿ ì„ íƒ (AI í—ˆê·¸, ëŒ„ìŠ¤ ëª¨ì…˜ ë“±)
4. ìº¡ì²˜ ì´ë¯¸ì§€ + í…œí”Œë¦¿ í”„ë¡¬í”„íŠ¸ â†’ I2V ëª¨ë¸ â†’ ìƒˆë¡œìš´ ì˜ìƒ ìƒì„±

**í¬ë ˆë”§**: 20 í¬ë ˆë”§  
**ìƒì„± ê¸¸ì´**: 5-10ì´ˆ  
**ëª¨ë¸**: `google/veo-3-fast`

### B. ê¸€ë¦¬ì¹˜ (Glitch) - WAN 2.2 ê¸°ë°˜ ë¦¬ë¯¹ìŠ¤
**ì‘ë™ ë°©ì‹**:
1. í”¼ë“œì—ì„œ ë§ˆìŒì— ë“œëŠ” ì˜ìƒì˜ 'ê¸€ë¦¬ì¹˜' ë²„íŠ¼ í´ë¦­
2. í•´ë‹¹ ì˜ìƒì´ ìŠ¤íŠœë””ì˜¤ë¡œ ë¡œë“œ (í…œí”Œë¦¿ ì˜ìƒìœ¼ë¡œ ì‚¬ìš©)
3. ë‚´ ì´ë¯¸ì§€ ì—…ë¡œë“œ OR ë‚´ ë©”ì¸ ì˜ìƒì—ì„œ í”„ë ˆì„ ìº¡ì²˜
4. ëª¨ë¸ ì„ íƒ:
   - **WAN 2.2 Animate**: í…œí”Œë¦¿ ì˜ìƒì˜ ëª¨ì…˜ì„ ë‚´ ì´ë¯¸ì§€ì— ì ìš©
   - **WAN 2.2 Replace**: í…œí”Œë¦¿ ì˜ìƒì˜ ì£¼ì²´ë¥¼ ë‚´ ì´ë¯¸ì§€ë¡œ êµì²´
5. I2V ìƒì„± â†’ ìƒˆë¡œìš´ ì˜ìƒ ì™„ì„±

**í¬ë ˆë”§**: 30 í¬ë ˆë”§  
**ìƒì„± ê¸¸ì´**: 5-10ì´ˆ  
**ëª¨ë¸**: `wan-video/wan-2.2-animate-animation`, `wan-video/wan-2.2-animate-replace`

### C. AI ìŒì•… ìƒì„±
**ì‘ë™ ë°©ì‹**:
- í…ìŠ¤íŠ¸ í”„ë¡¬í”„íŠ¸ ì…ë ¥ (ì˜ˆ: "ì‹ ë‚˜ëŠ” ì¼ë ‰íŠ¸ë¡œë‹‰ ë¹„íŠ¸")
- AIê°€ ì˜ìƒì— ì–´ìš¸ë¦¬ëŠ” ë°°ê²½ ìŒì•… ìƒì„±

**í¬ë ˆë”§**: 5 í¬ë ˆë”§  
**ê¸¸ì´**: 60ì´ˆ  
**ëª¨ë¸**: `suno-ai/bark`

---

## ğŸ“Š API ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡

### í”„ë ˆì„ ìº¡ì²˜
```
POST /v1/ai/capture-frame
```
**ìš”ì²­**:
```json
{
  "video_id": "uuid",
  "timestamp": 5.5
}
```
**ì‘ë‹µ**:
```json
{
  "image_url": "https://mock-s3.lokiz.dev/...",
  "timestamp": 5.5,
  "video_id": "uuid"
}
```

### ëª¨ì…˜/ìŠ¤íƒ€ì¼ í…œí”Œë¦¿
```
POST /v1/ai/template
```
**ìš”ì²­**:
```json
{
  "image_url": "https://...",
  "template": "ai_hug",
  "prompt": "Two people hugging with AI effect",
  "duration": 5
}
```
**í¬ë ˆë”§**: 20

### ê¸€ë¦¬ì¹˜ ëª¨ì…˜ ì ìš©
```
POST /v1/ai/glitch/animate
```
**ìš”ì²­**:
```json
{
  "template_video_id": "uuid",
  "user_image_url": "https://...",
  "prompt": "Apply dance motion"
}
```
**í¬ë ˆë”§**: 30

### ê¸€ë¦¬ì¹˜ ì£¼ì²´ êµì²´
```
POST /v1/ai/glitch/replace
```
**ìš”ì²­**:
```json
{
  "template_video_id": "uuid",
  "user_image_url": "https://...",
  "prompt": "Replace subject"
}
```
**í¬ë ˆë”§**: 30

### ìŒì•… ìƒì„±
```
POST /v1/ai/music
```
**ìš”ì²­**:
```json
{
  "prompt": "Upbeat electronic beat",
  "duration": 60
}
```
**í¬ë ˆë”§**: 5

### AI ì‘ì—… ìƒíƒœ ì¡°íšŒ
```
GET /v1/ai/jobs/{job_id}
```
**ì‘ë‹µ**:
```json
{
  "id": "uuid",
  "user_id": "uuid",
  "job_type": "i2v_template",
  "status": "completed",
  "input_data": {...},
  "output_data": {
    "video_url": "https://...",
    "model": "google/veo-3-fast"
  },
  "credits_used": 20,
  "created_at": "2025-10-29T...",
  "completed_at": "2025-10-29T..."
}
```

---

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

### AI ëª¨ë¸ (Replicate)
- **I2V**: `google/veo-3-fast` (15 í¬ë ˆë”§)
- **WAN 2.2 Animate**: `wan-video/wan-2.2-animate-animation` (30 í¬ë ˆë”§)
- **WAN 2.2 Replace**: `wan-video/wan-2.2-animate-replace` (30 í¬ë ˆë”§)
- **ìŒì•… ìƒì„±**: `suno-ai/bark` (5 í¬ë ˆë”§)

### ë¹„ë””ì˜¤ ì²˜ë¦¬
- **ffmpeg**: í”„ë ˆì„ ì¶”ì¶œ, ë¹„ë””ì˜¤ ê¸¸ì´ í™•ì¸
- **ffprobe**: ë¹„ë””ì˜¤ ë©”íƒ€ë°ì´í„° ë¶„ì„

### íŒŒì¼ ì €ì¥
- **Mock S3**: ê°œë°œ í™˜ê²½ìš© íŒŒì¼ ì €ì¥ì†Œ
- **ì‹¤ì œ ë°°í¬**: AWS S3 ì—°ë™ í•„ìš”

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### ê°œë°œ í™˜ê²½
- Mock S3 ì‚¬ìš© ì¤‘ (ì‹¤ì œ íŒŒì¼ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ ë¯¸êµ¬í˜„)
- í”„ë ˆì„ ìº¡ì²˜ ê¸°ëŠ¥ì€ ì‹¤ì œ ë¹„ë””ì˜¤ íŒŒì¼ì´ í•„ìš”
- Replicate API í˜¸ì¶œì€ ì‹¤ì œ í¬ë ˆë”§ ì†Œëª¨

### ì‹¤ì œ ë°°í¬ ì‹œ í•„ìš”í•œ ì‘ì—…
1. AWS S3 ì—°ë™
2. ì‹¤ì œ ë¹„ë””ì˜¤ íŒŒì¼ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ êµ¬í˜„
3. Replicate API í‚¤ ë³´ì•ˆ ê°•í™”
4. ë¹„ë™ê¸° ì‘ì—… ì²˜ë¦¬ (Celery ë˜ëŠ” RQ)
5. Webhook êµ¬í˜„ (AI ì‘ì—… ì™„ë£Œ ì•Œë¦¼)

---

## ğŸ“ˆ ë‹¤ìŒ ë‹¨ê³„ (Phase 4)

### ì†Œì…œ ê¸°ëŠ¥ API
1. ì¢‹ì•„ìš” API
2. ëŒ“ê¸€ API
3. íŒ”ë¡œìš° API
4. ë¦¬ë¯¹ìŠ¤ API
5. í”¼ë“œ ì•Œê³ ë¦¬ì¦˜

### í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ
1. React + TypeScript ì„¤ì •
2. ì¸ì¦ UI
3. ë¹„ë””ì˜¤ ì—…ë¡œë“œ UI
4. í”„ë ˆì„ ìº¡ì²˜ UI
5. AI í¸ì§‘ UI (í…œí”Œë¦¿, ê¸€ë¦¬ì¹˜)
6. í”¼ë“œ UI

---

## ğŸ‰ Phase 3 ì™„ë£Œ!

ëª¨ë“  AI ì‘ì—… APIê°€ ì„±ê³µì ìœ¼ë¡œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ì†Œì…œ ê¸°ëŠ¥ APIë¥¼ ê°œë°œí•˜ê±°ë‚˜ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

